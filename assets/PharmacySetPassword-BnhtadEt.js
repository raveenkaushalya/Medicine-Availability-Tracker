import{n as B,u as T,r as n,j as t,o as z,a as F}from"./index-DtW5QEov.js";function N(){const[b]=B(),P=T(),g=b.get("token"),[c,x]=n.useState(""),[u,S]=n.useState(""),[h,e]=n.useState(""),[d,f]=n.useState(!1),[s,w]=n.useState(null),[i,y]=n.useState(null),[a,k]=n.useState(null),[r,v]=n.useState(null),j=()=>{if(!navigator.geolocation){e("Geolocation is not supported in this device.");return}navigator.geolocation.getCurrentPosition(o=>{w(o.coords.latitude),y(o.coords.longitude),e("Location detected. Now press Confirm Location.")},()=>e("Location permission denied. Please pin on the map."),{enableHighAccuracy:!0,timeout:8e3})},L=()=>{if(s==null||i==null){e("Please select a location on the map first.");return}k(s),v(i),e("Location confirmed!")},C=async o=>{if(o.preventDefault(),!g){e("Token is missing in the link.");return}if(c.length<6){e("Password must be at least 6 characters.");return}if(c!==u){e("Passwords do not match.");return}if(a==null||r==null){e("Please pin your location and press Confirm Location.");return}try{f(!0),e(""),await F("/api/v1/pharmacies/set-password",{method:"POST",body:JSON.stringify({token:g,newPassword:c,confirmPassword:u,latitude:a,longitude:r})}),alert("Password set + Location saved!"),P("/")}catch(p){e(p?.response?.data?.message||"Failed to set password.")}finally{f(!1)}},l=a!=null&&r!=null,m=s!=null&&i!=null;return t.jsx("div",{style:{minHeight:"100vh",display:"grid",placeItems:"center",background:"#f4f4f4"},children:t.jsxs("form",{onSubmit:C,style:{width:420,background:"white",padding:24,borderRadius:12,boxShadow:"0 8px 25px rgba(0,0,0,0.08)"},children:[t.jsx("h2",{style:{marginBottom:16},children:"Set Pharmacy Password"}),h&&t.jsx("div",{style:{marginBottom:12,color:"red",fontSize:14},children:h}),t.jsx("label",{style:{fontSize:14},children:"New Password"}),t.jsx("input",{type:"password",value:c,onChange:o=>x(o.target.value),placeholder:"Enter new password",required:!0,style:{width:"100%",padding:10,marginTop:6,marginBottom:12}}),t.jsx("label",{style:{fontSize:14},children:"Confirm Password"}),t.jsx("input",{type:"password",value:u,onChange:o=>S(o.target.value),placeholder:"Re-enter password",required:!0,style:{width:"100%",padding:10,marginTop:6,marginBottom:12}}),t.jsx("button",{type:"button",onClick:j,style:{width:"100%",padding:10,borderRadius:8,border:"1px solid #ddd",background:"#fff",cursor:"pointer",marginBottom:12},children:"ðŸ“ Use my current location (GPS)"}),t.jsxs("div",{style:{marginBottom:12},children:[t.jsx("div",{style:{fontSize:14,marginBottom:8},children:"Pin your pharmacy location (click on map)"}),t.jsx(z,{onPick:(o,p)=>{w(o),y(p),e("")},initial:s!=null&&i!=null?{lat:s,lng:i}:a!=null&&r!=null?{lat:a,lng:r}:void 0}),s!=null&&i!=null&&t.jsxs("div",{style:{fontSize:12,marginTop:8,color:"#333"},children:["Picked: ",s.toFixed(6),", ",i.toFixed(6)]}),t.jsx("button",{type:"button",disabled:!m||d,onClick:L,style:{width:"100%",padding:10,borderRadius:8,border:"none",background:m?"#16a34a":"#bbb",color:"white",cursor:m?"pointer":"not-allowed",marginTop:10},children:"Confirm Location"}),l&&t.jsxs("div",{style:{fontSize:12,marginTop:8,color:"#333"},children:["Confirmed: ",a.toFixed(6),", ",r.toFixed(6)]})]}),t.jsx("button",{type:"submit",disabled:d||!l,style:{width:"100%",padding:10,borderRadius:8,border:"none",background:d||!l?"#888":"#2563eb",color:"white",cursor:d||!l?"not-allowed":"pointer"},children:d?"Setting...":l?"Set Password":"Confirm location first"})]})})}export{N as default};
